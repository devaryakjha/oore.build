# ==============================================================================
# Oore Server Configuration (.env.example)
# ==============================================================================
#
# This file documents ALL environment variables used by Oore.
# Copy this file to .env.local for development or /etc/oore/oore.env for production.
#
# For detailed documentation, see: https://oore.build/docs/configuration
#
# Quick Start (development):
#   cp .env.example .env.local
#   # Edit .env.local with your values
#   # Or run: ./install.local.sh --yes
#
# ==============================================================================

# ==============================================================================
# DATABASE
# ==============================================================================

# SQLite connection string (required)
# Development: sqlite:oore.db (creates file in working directory)
# Production: sqlite:/var/lib/oore/oore.db
DATABASE_URL=sqlite:oore.db

# Maximum database connection pool size (optional)
# Default: 20
# DATABASE_MAX_CONNECTIONS=20

# ==============================================================================
# SERVER CORE
# ==============================================================================

# Base URL for the server (used for generating webhook URLs)
# Must use HTTPS in production (unless OORE_DEV_MODE=true)
# Default: http://localhost:8080
OORE_BASE_URL=http://localhost:8080

# Enable development mode
# - Allows HTTP for non-localhost URLs
# - Relaxes HTTPS requirements
# - Enables additional logging
# Default: false
OORE_DEV_MODE=true

# Enable demo mode with simulated data
# - Provides fake repositories, builds, logs
# - Pre-configured GitHub/GitLab integrations
# - Useful for UI testing without real OAuth setup
# Default: false
# OORE_DEMO_MODE=true

# Demo scenario (only when OORE_DEMO_MODE=true)
# Options: normal, github_error, gitlab_error, build_failures
# Default: normal
# OORE_DEMO_SCENARIO=normal

# Custom environment file path
# Default: .env in working directory (dev) or /etc/oore/oore.env (installed)
# OORE_ENV_FILE=/path/to/custom.env

# ==============================================================================
# SECURITY & AUTHENTICATION
# ==============================================================================

# Admin API token for CLI/TUI authentication (recommended for production)
# Used for Bearer token authentication on protected endpoints
# Generate with: openssl rand -hex 32
# OORE_ADMIN_TOKEN=your-secure-random-token-min-32-chars

# Encryption key for storing sensitive credentials (AES-256-GCM)
# Required for: GitLab OAuth tokens, GitHub App credentials (encrypted storage)
# Must be exactly 64 hex characters (32 bytes)
# Generate with: openssl rand -hex 32
# ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# Trusted proxy CIDRs for X-Forwarded-For header processing
# Comma-separated list of CIDR ranges
# Required when running behind a reverse proxy (nginx, cloudflared, etc.)
# OORE_TRUSTED_PROXIES=127.0.0.0/8,::1/128

# ==============================================================================
# CORS
# ==============================================================================

# Allowed origin for CORS (web dashboard)
# Required for cross-origin requests from the dashboard
# Default: allows all in dev mode, none in production
OORE_DASHBOARD_ORIGIN=http://localhost:3000

# ==============================================================================
# BUILD PROCESSING
# ==============================================================================

# Directory for build workspaces (cloned repositories)
# Default: /var/lib/oore/workspaces
# OORE_WORKSPACES_DIR=/var/lib/oore/workspaces

# Directory for build logs
# Default: /var/lib/oore/logs
# OORE_LOGS_DIR=/var/lib/oore/logs

# Directory for build artifacts (IPAs, APKs, etc.)
# Default: /var/lib/oore/artifacts
# OORE_ARTIFACTS_DIR=/var/lib/oore/artifacts

# Maximum concurrent builds
# Default: 2
# OORE_MAX_CONCURRENT_BUILDS=2

# Maximum build duration in seconds
# Default: 3600 (1 hour)
# OORE_MAX_BUILD_DURATION_SECS=3600

# Maximum step duration in seconds
# Default: 1800 (30 minutes)
# OORE_MAX_STEP_DURATION_SECS=1800

# Maximum log file size in bytes
# Default: 52428800 (50 MB)
# OORE_MAX_LOG_SIZE_BYTES=52428800

# Workspace retention in hours (cleanup old workspaces)
# Default: 24
# OORE_WORKSPACE_RETENTION_HOURS=24

# ==============================================================================
# LOGGING
# ==============================================================================

# Rust log level filter
# Levels: error, warn, info, debug, trace
# Format: module=level,module2=level2 (or just level for all)
# Development: debug
# Production: oore_server=info,oore_core=info
RUST_LOG=debug

# ==============================================================================
# GITHUB INTEGRATION
# ==============================================================================
#
# RECOMMENDED: Use `oore github setup` to configure via the manifest flow.
# Credentials are stored encrypted in the database (no env vars needed).
#
# The environment variables below are for LEGACY/MANUAL configuration only
# (e.g., using a pre-existing GitHub App without the CLI setup flow).
# All three must be set together or none at all.

# GitHub App ID (legacy configuration)
# GITHUB_APP_ID=123456

# Path to GitHub App private key PEM file (legacy configuration)
# GITHUB_PRIVATE_KEY_PATH=/path/to/private-key.pem

# Webhook secret for signature verification (legacy configuration)
# Generate with: openssl rand -hex 20
# GITHUB_WEBHOOK_SECRET=your-webhook-secret

# Maximum repositories to sync per GitHub installation (DoS protection)
# Default: 1000
# GITHUB_MAX_REPOS_PER_INSTALLATION=1000

# ==============================================================================
# GITLAB INTEGRATION
# ==============================================================================

# Server pepper for HMAC computation of webhook tokens
# Required for GitLab integration (webhook security)
# Generate with: openssl rand -hex 32
# GITLAB_SERVER_PEPPER=your-random-pepper-32-chars

# Base URL for GitLab API
# Default: https://gitlab.com
# Change this for self-hosted GitLab instances
# GITLAB_API_BASE_URL=https://gitlab.com

# GitLab OAuth application ID (for gitlab.com)
# Required for GitLab OAuth flow
# OORE_GITLAB_CLIENT_ID=your-gitlab-app-id

# GitLab OAuth application secret (for gitlab.com)
# Required for GitLab OAuth flow
# OORE_GITLAB_CLIENT_SECRET=your-gitlab-app-secret

# ==============================================================================
# GITLAB SELF-HOSTED SECURITY (SSRF PROTECTION)
# ==============================================================================
#
# These settings control which self-hosted GitLab instances can connect.
# Important for preventing SSRF attacks when allowing private IPs.

# Comma-separated list of allowed GitLab hostnames (exact match)
# Example: gitlab.mycompany.com,git.internal.corp
# OORE_GITLAB_ALLOWED_HOSTS=gitlab.mycompany.com

# Comma-separated list of allowed CIDRs for self-hosted GitLab
# Enables private IP access for matching ranges
# Example: 10.0.0.0/8,192.168.1.0/24
# WARNING: Overly broad CIDRs (e.g., < /8 for IPv4) are rejected by default
# OORE_GITLAB_ALLOWED_CIDRS=10.0.0.0/8

# Allow overly broad CIDR ranges (use with caution!)
# Must be set to exactly "I_UNDERSTAND_THE_RISK" to enable
# OORE_ALLOW_BROAD_CIDRS=I_UNDERSTAND_THE_RISK

# Path to custom CA bundle for self-signed certificates
# Required for self-hosted GitLab with custom/internal CA
# OORE_GITLAB_CA_BUNDLE=/path/to/ca-bundle.crt

# ==============================================================================
# CLI/TUI CONFIGURATION
# ==============================================================================
#
# These are primarily for the `oore` CLI/TUI client, not the server.
# The CLI reads from ~/.oore/config.huml by default.

# Override config file path for CLI/TUI
# Default: ~/.oore/config.huml
# OORE_CONFIG=/path/to/config.huml

# Admin token for CLI authentication (same as server OORE_ADMIN_TOKEN)
# Can be set here or in ~/.oore/config.huml
# The CLI will use this token for Bearer authentication
# OORE_ADMIN_TOKEN=your-admin-token

# ==============================================================================
# WEB DASHBOARD (Next.js)
# ==============================================================================
#
# These variables are for the web dashboard (web/ directory).
# They should be set in web/.env.local (not the root .env.local).

# API base URL for the web dashboard
# Must match OORE_BASE_URL
# NEXT_PUBLIC_API_BASE_URL=http://localhost:8080

# ==============================================================================
# EXAMPLE CONFIGURATIONS
# ==============================================================================
#
# --- Minimal Development ---
# DATABASE_URL=sqlite:oore.db
# OORE_DEV_MODE=true
# RUST_LOG=debug
#
# --- Development with Secrets ---
# DATABASE_URL=sqlite:oore.db
# OORE_BASE_URL=http://localhost:8080
# OORE_DASHBOARD_ORIGIN=http://localhost:3000
# OORE_DEV_MODE=true
# ENCRYPTION_KEY=<run: openssl rand -hex 32>
# OORE_ADMIN_TOKEN=<run: openssl rand -hex 32>
# RUST_LOG=debug
#
# --- Production ---
# DATABASE_URL=sqlite:/var/lib/oore/oore.db
# OORE_BASE_URL=https://ci.example.com
# OORE_DASHBOARD_ORIGIN=https://dashboard.example.com
# ENCRYPTION_KEY=<run: openssl rand -hex 32>
# OORE_ADMIN_TOKEN=<run: openssl rand -hex 32>
# GITLAB_SERVER_PEPPER=<run: openssl rand -hex 32>
# RUST_LOG=oore_server=info,oore_core=info
#
# --- Production with Self-Hosted GitLab ---
# DATABASE_URL=sqlite:/var/lib/oore/oore.db
# OORE_BASE_URL=https://ci.example.com
# ENCRYPTION_KEY=<run: openssl rand -hex 32>
# OORE_ADMIN_TOKEN=<run: openssl rand -hex 32>
# GITLAB_SERVER_PEPPER=<run: openssl rand -hex 32>
# GITLAB_API_BASE_URL=https://gitlab.mycompany.com
# OORE_GITLAB_ALLOWED_HOSTS=gitlab.mycompany.com
# OORE_GITLAB_CA_BUNDLE=/etc/ssl/certs/mycompany-ca.crt
# RUST_LOG=oore_server=info
#
# ==============================================================================
