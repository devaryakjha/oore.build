---
title: GitHub Integration
description: Set up GitHub App for automated builds from push events and pull requests
banner:
  content: |
    This project is under active development. Some features may be incomplete.
---

import { Steps, Tabs, TabItem, Badge } from '@astrojs/starlight/components';

Oore integrates with GitHub using a **GitHub App**, providing:

- Webhook events for push, pull request, and other events
- Installation tokens for cloning private repositories
- Commit status updates for build results

## Setup via CLI (Recommended)

The easiest way to set up GitHub integration is using the **manifest flow**, which creates and configures the GitHub App automatically.

### Prerequisites

Before starting, ensure:
- Your Oore server is running and accessible
- You have an `ENCRYPTION_KEY` configured (required to store credentials securely)
- You have an `OORE_ADMIN_TOKEN` configured

### Step 1: Start Setup

```bash
oore github setup --admin-token YOUR_TOKEN
```

This returns a URL to create the GitHub App:

```
GitHub App Setup
================

Open this URL in your browser to create the GitHub App:

  https://your-server.com/setup/github/create?state=abc123...

After creating the app, GitHub will redirect you to a callback URL.
Copy the FULL redirect URL and run:

  oore github callback "<REDIRECT_URL>"
```

### Step 2: Create the App on GitHub

<Steps>
1. Open the URL in your browser
2. Review the pre-filled app configuration
3. Choose where to create the app (personal account or organization)
4. Click "Create GitHub App"
5. GitHub redirects you to a callback URL
</Steps>

### Step 3: Complete Setup

Copy the **full redirect URL** from your browser and run:

```bash
oore github callback "https://your-server.com/setup/github/callback?code=xyz&state=abc123"
```

On success, you'll see:

```
GitHub App configured successfully!

GitHub App: Configured

  App ID:         123456
  Name:           Oore CI - yourname
  Slug:           oore-ci-yourname
  Owner:          yourname (User)
  URL:            https://github.com/apps/oore-ci-yourname
  Installations:  0
```

### Step 4: Install the App

<Steps>
1. Go to the App URL shown in the output (e.g., `https://github.com/apps/oore-ci-yourname`)
2. Click "Install"
3. Select the account or organization
4. Choose which repositories to grant access
5. Click "Install"
</Steps>

### Step 5: Sync Repositories

After installation, sync the repositories to Oore:

```bash
oore github sync --admin-token YOUR_TOKEN
```

This fetches all installations and their repositories:

```
Syncing GitHub installations and repositories...

Sync completed
  Installations synced: 1
  Repositories synced:  3
```

### Step 6: Verify Setup

Check the current configuration:

```bash
oore github status --admin-token YOUR_TOKEN
```

List installations:

```bash
oore github installations --admin-token YOUR_TOKEN
```

---

## How It Works

The manifest flow automates GitHub App creation:

```
CLI                    oored                    GitHub
 │                       │                        │
 │  github setup         │                        │
 ├──────────────────────▶│                        │
 │                       │ Generate manifest      │
 │    URL to open        │                        │
 │◀──────────────────────┤                        │
 │                       │                        │
 │  User opens URL ──────┼───────────────────────▶│
 │                       │                        │ Create App
 │  User gets callback URL ◀─────────────────────┤
 │                       │                        │
 │  github callback URL  │                        │
 ├──────────────────────▶│                        │
 │                       │  Exchange code ───────▶│
 │                       │◀─── App credentials ───┤
 │                       │  Store encrypted       │
 │    Success!           │                        │
 │◀──────────────────────┤                        │
```

Once configured:
- Credentials are stored **encrypted** in the database (AES-256-GCM)
- No environment variables needed for GitHub config
- Private key, webhook secret, and app details are managed automatically

---

## Webhook Processing

When GitHub sends webhooks:

```
GitHub                          oored                      Build
  │                               │                          │
  │  POST /webhooks/github        │                          │
  ├──────────────────────────────▶│                          │
  │                               │ 1. Verify signature      │
  │                               │ 2. Store event           │
  │                               │ 3. Queue for processing  │
  │        {"status":"ok"}        │                          │
  │◀──────────────────────────────┤                          │
  │                               │ 4. Process background    │
  │                               │ 5. Create build          │
  │                               │ 6. Execute               │
  │                               ├─────────────────────────▶│
```

### Supported Events

| Event | Trigger |
|-------|---------|
| `push` | Code pushed to any branch |
| `pull_request.opened` | New pull request |
| `pull_request.synchronize` | PR updated with new commits |
| `create` | Branch or tag created |

### Signature Verification

GitHub signs webhooks using HMAC-SHA256. The `X-Hub-Signature-256` header contains:

```
sha256=<hex-encoded-signature>
```

Oore verifies this signature using the webhook secret stored during setup.

---

## CLI Commands Reference

| Command | Description |
|---------|-------------|
| `oore github setup` | Start GitHub App creation via manifest flow |
| `oore github callback <URL>` | Complete setup with callback URL from GitHub |
| `oore github status` | Show current GitHub App configuration |
| `oore github installations` | List all installations |
| `oore github sync` | Sync installations and repositories from GitHub |
| `oore github remove --force` | Remove GitHub App credentials |

All commands require `--admin-token YOUR_TOKEN` (or set `OORE_ADMIN_TOKEN` env var).

---

## Troubleshooting

### "ENCRYPTION_NOT_CONFIGURED" Error

The manifest flow requires an encryption key to securely store credentials.

Add to `/etc/oore/oore.env`:
```bash
ENCRYPTION_KEY=$(openssl rand -hex 32)
```

Then restart the server.

### "ALREADY_CONFIGURED" Error

A GitHub App is already configured. To replace it:

```bash
oore github remove --force --admin-token YOUR_TOKEN
oore github setup --admin-token YOUR_TOKEN
```

### Webhooks Not Received

1. **Check URL accessibility**: Your server must be publicly accessible (not localhost)
2. **Check HTTPS**: GitHub requires HTTPS for webhooks
3. **Check firewall**: Ensure the port is open
4. **View deliveries**: Go to your GitHub App settings → Advanced → Recent Deliveries

### Invalid Signature Errors

1. Run `oore github sync` to refresh credentials
2. Check that the webhook URL matches your server's `OORE_BASE_URL`
3. Reinstall the GitHub App if issues persist

### Installation Not Found

1. Run `oore github installations` to verify the installation exists
2. Run `oore github sync` to refresh the installation list
3. Check that the app is installed on the repository's owner account

---

## Complete Example

```bash
# 1. Ensure prerequisites
export OORE_ADMIN_TOKEN="your-secure-token"

# 2. Start GitHub App setup
oore github setup

# 3. Open the URL, create the app, copy callback URL

# 4. Complete setup
oore github callback "https://..."

# 5. Install the app on GitHub (via the App URL)

# 6. Sync repositories
oore github sync

# 7. Verify
oore github status
oore github installations

# 8. Push code to trigger a build
git push origin main

# 9. Check builds
oore build list
```
