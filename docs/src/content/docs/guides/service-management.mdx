---
title: Service Management
description: Install, configure, and manage the oored server as a system service
banner:
  content: |
    ⚠️ <strong>Experimental</strong> — The service runs but builds don't execute yet. For contributors only.
---

import { Steps, Tabs, TabItem, Card, CardGrid } from '@astrojs/starlight/components';

The `oored` binary can run in two modes:

<CardGrid>
  <Card title="Foreground Mode" icon="laptop">
    Run directly in your terminal for development (`oored run`)
  </Card>
  <Card title="Service Mode" icon="server">
    Run as a system daemon that starts at boot
  </Card>
</CardGrid>

Service mode is recommended for production deployments.

## Local Development

For local development, use the setup script to configure your environment:

```bash
# Interactive setup (prompts for configuration)
./install.local.sh

# Non-interactive setup (uses defaults)
./install.local.sh --yes
```

This creates `.env.local` with database URL, encryption keys, and dev mode settings.

### Running the Server

**Foreground mode** (recommended for development):
```bash
cargo run -p oore-server
# or after building:
./target/debug/oored run
```

**Background mode** (without service install):
```bash
# Using nohup
nohup cargo run -p oore-server > oored.log 2>&1 &

# Or with the built binary
nohup ./target/debug/oored run > oored.log 2>&1 &

# View logs
tail -f oored.log

# Stop the server
pkill -f oored
```

**Using tmux/screen** (alternative):
```bash
tmux new -d -s oore 'cargo run -p oore-server'
tmux attach -t oore  # to view
```

:::note
The `oored logs` command only works with the installed service (reads from `/var/log/oore/oored.log`). For local dev, use `tail -f oored.log` or run in foreground.
:::

## Production Setup (Service Mode)

## Quick Start

```bash
# Build the server
cargo build --release -p oore-server

# Initialize environment (generates secrets)
sudo ./target/release/oored init --base-url https://your-server.com

# (Optional) Review/edit configuration
sudo nano /etc/oore/oore.env

# Install as system service
sudo ./target/release/oored install

# Start the service
sudo oored start

# Check status
oored status

# View logs
oored logs -f
```

## Commands Reference

### oored run

Run the server in foreground mode.

```bash
oored run
# or simply
oored
```

### oored init

Initialize the server environment file at `/etc/oore/oore.env`. Generates secure random values for secrets. Requires root.

```bash
sudo oored init [OPTIONS]
```

| Option | Default | Description |
|--------|---------|-------------|
| `--base-url <URL>` | `http://localhost:8080` | Public URL for webhook callbacks |
| `--database-url <URL>` | `sqlite:/var/lib/oore/oore.db` | Database connection string |
| `--force` | - | Regenerate all secrets (destructive!) |
| `--dry-run` | - | Preview without writing |

**Example:**

```bash
# Preview what would be generated
sudo oored init --dry-run

# Initialize with custom base URL
sudo oored init --base-url https://ci.example.com

# Regenerate all secrets (WARNING: invalidates existing data)
sudo oored init --force
```

**What it creates:**

```bash
DATABASE_URL=sqlite:/var/lib/oore/oore.db
OORE_BASE_URL=http://localhost:8080
OORE_ADMIN_TOKEN=<generated>
ENCRYPTION_KEY=<generated>
GITLAB_SERVER_PEPPER=<generated>
```

:::caution
Using `--force` regenerates the `ENCRYPTION_KEY`, which will make existing encrypted credentials unreadable!
:::

### oored install

Install as a system service. Requires root.

```bash
sudo oored install [--env-file <PATH>] [--force]
```

| Option | Description |
|--------|-------------|
| `--env-file <PATH>` | Custom environment file to copy |
| `--force, -f` | Force reinstall |

**What it does:**

<Steps>
1. Creates directories: `/var/lib/oore`, `/var/log/oore`, `/etc/oore`
2. Copies binary to `/usr/local/bin/oored`
3. Copies/creates environment file at `/etc/oore/oore.env`
4. Writes service definition (launchd/systemd)
5. Configures log rotation
6. Enables the service (but does not start it)
</Steps>

### oored uninstall

Remove the system service.

```bash
sudo oored uninstall [--purge]
```

| Option | Description |
|--------|-------------|
| `--purge` | Also remove data, logs, and configuration |

### oored start / stop / restart

Control the service.

```bash
sudo oored start
sudo oored stop
sudo oored restart
```

### oored status

Show service status.

```bash
oored status
```

```
Status: Installed
Running: Yes
PID: 12345
Binary: /usr/local/bin/oored
Logs: /var/log/oore/oored.log
```

### oored logs

View service logs.

```bash
oored logs              # Last 50 lines
oored logs -n 100       # Last 100 lines
oored logs -f           # Follow in real-time
```

## Troubleshooting

### Service Won't Start

**Database permission error:**
```
Error: unable to open database file
```
Ensure `/var/lib/oore` exists and is writable.

**Port already in use:**
```
Error: Address already in use
```
Check what's using port 8080:
```bash
sudo lsof -i :8080
```

**Missing configuration:**
```
Error: DATABASE_URL must be set
```
Edit `/etc/oore/oore.env` and add required variables.

### macOS: "Operation not permitted"

1. Ensure you're using `sudo`
2. Check Terminal.app has Full Disk Access (System Preferences > Privacy)

## Platform Details

<Tabs>
  <TabItem label="macOS (launchd)">
    **Service definition:** `/Library/LaunchDaemons/build.oore.oored.plist`

    Key features:
    - `RunAtLoad`: Starts at boot
    - `KeepAlive`: Restarts on crash
    - `ThrottleInterval`: 5 seconds between restarts

    **Commands:**
    ```bash
    launchctl bootstrap system /path/to/plist   # Load
    launchctl bootout system/build.oore.oored   # Unload
    launchctl kickstart -kp system/build.oore.oored  # Start
    ```

    **Log rotation:** newsyslog at `/etc/newsyslog.d/oore.conf`
  </TabItem>
  <TabItem label="Linux (systemd)">
    **Service definition:** `/etc/systemd/system/oored.service`

    Key features:
    - `Type=simple`: Standard daemon
    - `Restart=always`: Restart on any exit
    - Security hardening enabled

    **Commands:**
    ```bash
    systemctl daemon-reload
    systemctl enable oored.service
    systemctl start oored.service
    systemctl status oored.service
    ```

    **Log rotation:** logrotate at `/etc/logrotate.d/oore`
  </TabItem>
</Tabs>

## File Layout

```
/usr/local/bin/oored              # Binary
/etc/oore/oore.env                # Configuration
/var/lib/oore/oore.db             # Database
/var/log/oore/oored.log           # Logs

# macOS
/Library/LaunchDaemons/build.oore.oored.plist

# Linux
/etc/systemd/system/oored.service
```
