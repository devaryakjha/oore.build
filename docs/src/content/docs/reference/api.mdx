---
title: API Reference
description: REST API documentation for the Oore server
banner:
  content: |
    ⚠️ <strong>Experimental</strong> — API endpoints may change without notice. For contributors only.
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

The Oore server exposes a REST API for managing repositories, builds, and integrations.

## Base URL

```
http://localhost:8080/api
```

In production, configure `BASE_URL` to your public domain.

## Authentication

Protected endpoints require an admin token:

```
Authorization: Bearer YOUR_ADMIN_TOKEN
```

---

## Health & Status

### GET /api/health

```bash
curl http://localhost:8080/api/health
```

```json
{"status": "ok"}
```

### GET /api/version

```json
{"name": "oored", "version": "0.1.0"}
```

### GET /api/setup/status

Requires admin token.

```json
{
  "github": {
    "configured": true,
    "app_name": "my-oore-app",
    "installations_count": 2
  },
  "gitlab": [{
    "configured": true,
    "instance_url": "https://gitlab.com",
    "username": "myuser"
  }],
  "encryption_configured": true,
  "admin_token_configured": true
}
```

---

## Repositories

### GET /api/repositories

List all repositories.

```json
[{
  "id": "01HNJX5Q9T3WP2V6Z8K4M7YRBF",
  "name": "my-flutter-app",
  "provider": "github",
  "owner": "myorg",
  "repo_name": "my-app",
  "clone_url": "https://github.com/myorg/my-app.git",
  "default_branch": "main",
  "is_active": true,
  "created_at": "2024-01-15T10:30:00Z"
}]
```

### POST /api/repositories

Create a repository.

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `provider` | string | Yes | `github` or `gitlab` |
| `owner` | string | Yes | Owner name |
| `repo_name` | string | Yes | Repository name |
| `name` | string | No | Display name |
| `default_branch` | string | No | Default: `main` |
| `webhook_secret` | string | No | GitLab only |
| `github_repository_id` | number | No | GitHub repository ID |
| `github_installation_id` | number | No | GitHub App installation ID |
| `gitlab_project_id` | number | No | GitLab project ID |

### GET /api/repositories/:id

Get a repository.

### PUT /api/repositories/:id

Update a repository.

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | string | No | Display name |
| `default_branch` | string | No | Default branch |
| `is_active` | boolean | No | Active status |
| `webhook_secret` | string | No | GitLab webhook secret (re-hashed) |
| `github_installation_id` | number | No | GitHub App installation ID |
| `gitlab_project_id` | number | No | GitLab project ID |

### DELETE /api/repositories/:id

Delete a repository.

### GET /api/repositories/:id/webhook-url

Get webhook URL for provider configuration.

<Tabs>
  <TabItem label="GitHub">
    ```json
    {
      "webhook_url": "https://ci.example.com/api/webhooks/github",
      "provider": "github"
    }
    ```
  </TabItem>
  <TabItem label="GitLab">
    ```json
    {
      "webhook_url": "https://ci.example.com/api/webhooks/gitlab/01HNJX...",
      "provider": "gitlab"
    }
    ```
  </TabItem>
</Tabs>

### POST /api/repositories/:id/trigger

Trigger a build.

```json
{
  "branch": "develop",
  "commit_sha": "abc1234567890"
}
```

Both fields are optional.

---

## Builds

### GET /api/builds

List builds. Optional `?repo=<ID>` filter.

```json
[{
  "id": "01HNJX9P2K4TM8Q6V5W3Y7ZRAD",
  "repository_id": "01HNJX5Q9T3WP2V6Z8K4M7YRBF",
  "commit_sha": "abc1234...",
  "branch": "main",
  "trigger_type": "webhook",
  "status": "running",
  "started_at": "2024-01-15T10:35:02Z",
  "created_at": "2024-01-15T10:35:00Z"
}]
```

**Statuses:** `pending`, `running`, `success`, `failed`, `cancelled`

**Triggers:** `webhook`, `manual`

### GET /api/builds/:id

Get a build.

### POST /api/builds/:id/cancel

Cancel a running build.

### GET /api/builds/:id/artifacts

List artifacts for a build.

```json
[{
  "id": "01HNJXB3K7TM9Q8V6W4Y2ZRCEF",
  "build_id": "01HNJX9P2K4TM8Q6V5W3Y7ZRAD",
  "name": "MyApp.ipa",
  "artifact_type": "ipa",
  "platform": "ios",
  "file_path": "/var/lib/oore/artifacts/01HNJX.../MyApp.ipa",
  "file_size": 45678901,
  "checksum_sha256": "abc123...",
  "metadata": {
    "bundle_id": "com.example.myapp",
    "version": "1.0.0",
    "build_number": "42"
  },
  "created_at": "2024-01-15T10:45:00Z"
}]
```

**Artifact types:** `ipa`, `apk`, `aab`, `dsym`, `mapping`, `other`

**Platforms:** `ios`, `android`, `macos`, `web`, `other`

### GET /api/builds/:id/artifacts/:artifact_id

Download an artifact. Returns the binary file with appropriate content headers.

**Response Headers:**
- `Content-Type`: `application/octet-stream`
- `Content-Disposition`: `attachment; filename="MyApp.ipa"`
- `Content-Length`: File size in bytes

---

## Signing

Code signing configuration for iOS certificates/profiles and Android keystores. All signing endpoints require admin authentication.

### GET /api/repositories/:id/signing/status

Get signing configuration status for a repository.

```json
{
  "ios": {
    "certificates_count": 2,
    "profiles_count": 3,
    "has_distribution_certificate": true,
    "has_development_certificate": true
  },
  "android": {
    "keystores_count": 1,
    "has_release_keystore": true
  }
}
```

### GET /api/repositories/:id/signing/ios/certificates

List iOS certificates for a repository.

```json
[{
  "id": "01HNJXC4L8UN0R9W7X5Z3ASDGH",
  "repository_id": "01HNJX5Q9T3WP2V6Z8K4M7YRBF",
  "name": "iOS Distribution",
  "certificate_type": "distribution",
  "team_id": "ABC123DEF",
  "team_name": "My Company Inc.",
  "common_name": "Apple Distribution: My Company Inc.",
  "serial_number": "1234567890ABCDEF",
  "expires_at": "2025-01-15T00:00:00Z",
  "is_expired": false,
  "created_at": "2024-01-15T10:30:00Z"
}]
```

**Certificate types:** `development`, `distribution`

### POST /api/repositories/:id/signing/ios/certificates

Upload an iOS certificate (.p12 file).

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `certificate_data_base64` | string | Yes | Base64-encoded .p12 file |
| `password` | string | Yes | Certificate password |
| `name` | string | Yes | Display name |
| `certificate_type` | string | Yes | `development` or `distribution` |

```json
{
  "certificate_data_base64": "MIIKYgIBAzCCCiIG...",
  "password": "cert-password",
  "name": "iOS Distribution",
  "certificate_type": "distribution"
}
```

### DELETE /api/repositories/:id/signing/ios/certificates/:cert_id

Delete an iOS certificate.

### GET /api/repositories/:id/signing/ios/profiles

List iOS provisioning profiles for a repository.

```json
[{
  "id": "01HNJXD5M9VO1SA8Y6Z4BTEFIJ",
  "repository_id": "01HNJX5Q9T3WP2V6Z8K4M7YRBF",
  "name": "MyApp AdHoc",
  "profile_type": "ad_hoc",
  "bundle_id": "com.example.myapp",
  "team_id": "ABC123DEF",
  "team_name": "My Company Inc.",
  "uuid": "12345678-1234-1234-1234-123456789012",
  "expires_at": "2025-01-15T00:00:00Z",
  "is_expired": false,
  "devices_count": 25,
  "created_at": "2024-01-15T10:30:00Z"
}]
```

**Profile types:** `development`, `ad_hoc`, `app_store`, `enterprise`

### POST /api/repositories/:id/signing/ios/profiles

Upload an iOS provisioning profile (.mobileprovision file).

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `profile_data_base64` | string | Yes | Base64-encoded .mobileprovision file |
| `name` | string | No | Display name (extracted from profile if not provided) |

```json
{
  "profile_data_base64": "MIIabCdEfGhIjK...",
  "name": "MyApp AdHoc Profile"
}
```

### DELETE /api/repositories/:id/signing/ios/profiles/:profile_id

Delete an iOS provisioning profile.

### GET /api/repositories/:id/signing/android/keystores

List Android keystores for a repository.

```json
[{
  "id": "01HNJXE6N0WP2TB9Z7A5CUFGKL",
  "repository_id": "01HNJX5Q9T3WP2V6Z8K4M7YRBF",
  "name": "Release Keystore",
  "keystore_type": "release",
  "key_alias": "upload-key",
  "validity_start": "2024-01-01T00:00:00Z",
  "validity_end": "2049-01-01T00:00:00Z",
  "is_expired": false,
  "created_at": "2024-01-15T10:30:00Z"
}]
```

**Keystore types:** `debug`, `release`

### POST /api/repositories/:id/signing/android/keystores

Upload an Android keystore (.jks or .keystore file).

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `keystore_data_base64` | string | Yes | Base64-encoded keystore file |
| `keystore_password` | string | Yes | Keystore password |
| `key_alias` | string | Yes | Key alias within the keystore |
| `key_password` | string | Yes | Key password |
| `name` | string | Yes | Display name |
| `keystore_type` | string | No | `debug` or `release` (default: `release`) |

```json
{
  "keystore_data_base64": "MIIKYgIBAzCCCiIG...",
  "keystore_password": "keystore-pass",
  "key_alias": "upload-key",
  "key_password": "key-pass",
  "name": "Release Keystore",
  "keystore_type": "release"
}
```

### DELETE /api/repositories/:id/signing/android/keystores/:keystore_id

Delete an Android keystore.

---

## Webhooks

### POST /api/webhooks/github

Receive GitHub webhooks.

**Headers:**
- `X-Hub-Signature-256`: HMAC-SHA256 signature
- `X-GitHub-Event`: Event type
- `X-GitHub-Delivery`: Delivery ID

**Responses:**

| Status | Body | Description |
|--------|------|-------------|
| 202 | `{"status": "accepted", "event_id": "..."}` | Event queued for processing |
| 200 | `{"status": "duplicate"}` | Duplicate delivery (idempotent) |
| 503 | `{"status": "queued_for_recovery", ...}` | Queue full, will process on recovery |
| 401 | `{"error": "Invalid signature"}` | Signature verification failed |

### POST /api/webhooks/gitlab/:repo_id

Receive GitLab webhooks.

**Headers:**
- `X-Gitlab-Token`: Secret token
- `X-Gitlab-Event`: Event type

**Responses:**

| Status | Body | Description |
|--------|------|-------------|
| 202 | `{"status": "accepted", "event_id": "..."}` | Event queued for processing |
| 200 | `{"status": "duplicate"}` | Duplicate delivery (idempotent) |
| 503 | `{"status": "queued_for_recovery", ...}` | Queue full, will process on recovery |
| 401 | `{"error": "Invalid token"}` | Token verification failed |

### GET /api/webhooks/events

List webhook events.

### GET /api/webhooks/events/:id

Get webhook event with payload.

---

## GitHub Integration

| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/api/github/manifest` | Yes | Get manifest and creation URL |
| POST | `/api/github/callback` | Yes | Exchange code for credentials |
| GET | `/api/github/app` | Yes | Get current App configuration |
| DELETE | `/api/github/app` | Yes | Remove App credentials (requires `?force=true`) |
| GET | `/api/github/installations` | Yes | List installations |
| POST | `/api/github/sync` | Yes | Sync installations and repos from GitHub |

## GitLab Integration

| Method | Path | Auth | Description |
|--------|------|------|-------------|
| POST | `/api/gitlab/connect` | Yes | Initiate OAuth flow |
| POST | `/api/gitlab/callback` | Yes | Exchange code for credentials |
| GET | `/api/gitlab/credentials` | Yes | List all credentials |
| DELETE | `/api/gitlab/credentials/:id` | Yes | Remove credentials with cascade cleanup (requires `?force=true`) |
| GET | `/api/gitlab/projects` | Yes | List accessible projects |
| PUT | `/api/gitlab/projects/:id/enabled` | Yes | Enable CI for project |
| DELETE | `/api/gitlab/projects/:id/enabled` | Yes | Disable CI for project |
| POST | `/api/gitlab/refresh` | Yes | Refresh OAuth token |
| POST | `/api/gitlab/apps` | Yes | Register OAuth app for self-hosted GitLab |

:::note[Credential Deletion]
Deleting GitLab credentials also cleans up associated enabled projects, removes webhooks from GitLab (best effort), and deactivates related repositories.
:::

---

## Error Responses

```json
{"error": "Repository not found"}
```

| Code | Description |
|------|-------------|
| 400 | Invalid request |
| 401 | Unauthorized |
| 404 | Not found |
| 500 | Server error |

---

## Webhook Security

### GitHub

HMAC-SHA256 signature in `X-Hub-Signature-256`:
```
sha256=<hex-signature>
```

### GitLab

Secret token in `X-Gitlab-Token`. Oore stores HMAC hash, not plaintext.
