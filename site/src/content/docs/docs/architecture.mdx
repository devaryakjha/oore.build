---
title: Architecture
description: System design and component overview of the Oore CI/CD platform
banner:
  content: |
    <strong>Alpha</strong> — Core architecture is stable. Distribution features are the next milestone.
---

import { Card, CardGrid, Tabs, TabItem } from '@astrojs/starlight/components';

Oore is a self-hosted CI/CD platform where your Mac is the server. Built with Rust for the backend and Next.js for the web dashboard.

## Deployment Topology

The key architectural decision: **the server runs on your Mac, clients connect remotely**.

```
┌─────────────────────┐                    ┌─────────────────────────────────────┐
│   Remote Clients    │                    │       Your Mac (the server)          │
│   (run anywhere)    │                    │                                      │
│                     │                    │  ┌──────────────────────────────┐   │
│  ┌───────────────┐  │      HTTPS         │  │          oored               │   │
│  │    Browser    │──┼───────────────────▶│  │       (HTTP server)          │   │
│  └───────────────┘  │                    │  │                              │   │
│                     │                    │  │  ┌────────┐  ┌────────────┐  │   │
│                     │                    │  │  │REST API│  │ Background │  │   │
│                     │                    │  │  │        │  │   Worker   │  │   │
│                     │                    │  │  └────────┘  └────────────┘  │   │
└─────────────────────┘                    │  └──────────────────────────────┘   │
                                           │           │                         │
         GitHub/GitLab ────webhooks───────▶│     ┌─────┴─────┐                   │
                                           │     ▼           ▼                   │
                                           │  ┌──────┐   ┌──────────────────┐   │
                                           │  │SQLite│   │     Keychain      │   │
                                           │  │  DB  │   │  certs/profiles   │   │
                                           │  └──────┘   └──────────────────┘   │
                                           │                                      │
                                           │  ┌──────────────────────────────┐   │
                                           │  │   Artifacts (/var/lib/oore)   │   │
                                           │  │   .ipa, .apk, logs            │   │
                                           │  └──────────────────────────────┘   │
                                           └─────────────────────────────────────┘
```

**What runs where:**

| Component | Location | Why |
|-----------|----------|-----|
| `oored` (server) | **On the Mac** | Needs Keychain access, Xcode, build tools |
| Web dashboard | Anywhere | Just a browser app |
| SQLite database | On the Mac | Server-side storage |
| Artifacts | On the Mac | Build outputs |

## Components

<CardGrid>
  <Card title="oore-core" icon="puzzle">
    Shared library with database layer, models, crypto, and webhook handling.
  </Card>
  <Card title="oore-server (oored)" icon="server">
    HTTP server daemon with Axum, REST API, and background worker.
  </Card>
  <Card title="web (Next.js)" icon="external">
    Web dashboard with shadcn/ui components.
  </Card>
</CardGrid>

### oore-core

The shared library containing:

- **Database layer**: SQLx with SQLite, automatic migrations
- **Models**: Repository, Build, WebhookEvent, Provider types
- **Crypto**: HMAC verification, AES-256-GCM encryption
- **Webhook handling**: Signature verification, payload parsing
- **Provider configs**: GitHub App, GitLab OAuth

### oore-server (oored)

The HTTP server daemon:

- **Framework**: Axum web framework
- **Routes**: REST API endpoints
- **State**: Database pool, configuration, provider configs
- **Worker**: Background webhook processor
- **Service management**: Install/start/stop as system service

## Data Flow

### Webhook Processing

```
GitHub/GitLab                    oored                       Build Executor
     │                            │                               │
     │  POST /webhooks/github     │                               │
     ├───────────────────────────▶│                               │
     │                            │ 1. Verify signature           │
     │                            │ 2. Store event                │
     │                            │ 3. Queue for processing       │
     │         {"status":"ok"}    │                               │
     │◀───────────────────────────┤                               │
     │                            │                               │
     │                            │ 4. Process in background      │
     │                            │ 5. Create build record        │
     │                            │ 6. Execute build              │
     │                            ├──────────────────────────────▶│
```

## Design Decisions

### Why Rust?

- **Performance**: Handles concurrent builds efficiently
- **Safety**: Memory safety without garbage collection
- **Single binary**: Easy deployment, no runtime dependencies
- **Cross-platform**: Builds for macOS and Linux from same codebase

### Why SQLite?

- **Simplicity**: No separate database server to manage
- **Portability**: Single file, easy backup/migration
- **Performance**: WAL mode provides excellent read/write performance

:::note
For most self-hosted scenarios, SQLite is sufficient. The design allows for PostgreSQL support if needed in the future.
:::

### Why ULID for IDs?

| Benefit | Description |
|---------|-------------|
| Sortable | Lexicographically sortable by timestamp |
| Unique | 128-bit random component |
| URL-safe | No special characters |
| Readable | Easier to work with than UUIDs |

Example: `01HNJX5Q9T3WP2V6Z8K4M7YRBF`

### Why Async Webhook Processing?

GitHub requires webhook responses within 10 seconds. Processing might take longer, so:

1. Receive webhook, verify signature
2. Store event in database immediately
3. Return success response
4. Process in background worker

## Security Model

### Secrets Storage

| Secret | Storage | Protection |
|--------|---------|------------|
| Admin token | Environment | File permissions (0600) |
| Encryption key | Environment | File permissions (0600) |
| GitHub webhook secret | Environment/Database | File permissions or AES-256-GCM encrypted |
| GitLab webhook tokens | Database | HMAC-SHA256 (not plaintext) |
| OAuth tokens | Database | AES-256-GCM encryption with AAD |

### SSRF Protection

For self-hosted GitLab instances, Oore implements comprehensive SSRF (Server-Side Request Forgery) protection:

| Protection | Description |
|------------|-------------|
| Private IP blocking | Rejects connections to private ranges (10.x, 172.16.x, 192.168.x) |
| Loopback blocking | Blocks localhost and 127.0.0.1 |
| CGN blocking | Blocks shared carrier-grade NAT (100.64.0.0/10) |
| IPv6 ULA blocking | Blocks unique local addresses (fc00::/7) |
| DNS rebinding protection | Pins resolved IPs at validation time |
| Redirect blocking | Disables automatic HTTP redirects |

:::note
Configure `OORE_GITLAB_ALLOWED_CIDRS` to allow specific private IP ranges for self-hosted GitLab instances.
:::

## File Layout

<Tabs>
  <TabItem label="Development">
    ```
    oore.build/
    ├── crates/
    │   ├── oore-core/           # Shared library
    │   │   ├── migrations/      # Database migrations
    │   │   └── src/
    │   └── oore-server/         # Server daemon
    │       └── src/
    ├── web/                     # Next.js dashboard
    └── site/                    # Documentation + landing (Astro/Starlight)
    ```
  </TabItem>
  <TabItem label="Production">
    ```
    /usr/local/bin/oored         # Server binary
    /etc/oore/oore.env           # Server configuration
    /var/lib/oore/oore.db        # SQLite database
    /var/log/oore/oored.log      # Server logs

    # macOS
    /Library/LaunchDaemons/build.oore.oored.plist

    # Linux
    /etc/systemd/system/oored.service
    ```
  </TabItem>
</Tabs>
